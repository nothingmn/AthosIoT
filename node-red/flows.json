[
    {
        "id": "d1652d7f.bc5368",
        "type": "tab",
        "label": "System",
        "disabled": false,
        "info": ""
    },
    {
        "id": "d86e1a52.17604",
        "type": "tab",
        "label": "Relay Node",
        "disabled": false,
        "info": ""
    },
    {
        "id": "c5efaa53.c108",
        "type": "tab",
        "label": "Node Commands",
        "disabled": false,
        "info": ""
    },
    {
        "id": "15023940.e18267",
        "type": "tab",
        "label": "Motion Sensing",
        "disabled": false,
        "info": ""
    },
    {
        "id": "9621a124.97df",
        "type": "mqtt-broker",
        "z": "",
        "name": "localhost",
        "broker": "localhost",
        "port": "1883",
        "clientid": "",
        "usetls": false,
        "compatmode": true,
        "keepalive": "60",
        "cleansession": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthPayload": "",
        "closeTopic": "",
        "closeQos": "0",
        "closePayload": "",
        "willTopic": "",
        "willQos": "0",
        "willPayload": ""
    },
    {
        "id": "1fd1dcb7.25cbf3",
        "type": "mqtt-broker",
        "z": "",
        "name": "MQTT Broker",
        "broker": "localhost",
        "port": "1883",
        "clientid": "",
        "usetls": false,
        "compatmode": true,
        "keepalive": "60",
        "cleansession": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthPayload": "",
        "closeTopic": "",
        "closeQos": "0",
        "closePayload": "",
        "willTopic": "",
        "willQos": "0",
        "willPayload": ""
    },
    {
        "id": "dd34f558.67dd78",
        "type": "mqtt-broker",
        "z": "",
        "name": "Home MQTT",
        "broker": "home.mqtt.server",
        "port": "1883",
        "clientid": "",
        "usetls": false,
        "compatmode": false,
        "keepalive": "60",
        "cleansession": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthPayload": "",
        "closeTopic": "",
        "closeQos": "0",
        "closePayload": "",
        "willTopic": "",
        "willQos": "0",
        "willPayload": ""
    },
    {
        "id": "f417d62b.4aaa08",
        "type": "udp in",
        "z": "d1652d7f.bc5368",
        "name": "",
        "iface": "",
        "port": "3000",
        "ipv": "udp4",
        "multicast": "true",
        "group": "255.255.255.255",
        "datatype": "utf8",
        "x": 130,
        "y": 60,
        "wires": [
            [
                "71ffc66b.4963e"
            ]
        ]
    },
    {
        "id": "70389f48.06d2e8",
        "type": "debug",
        "z": "d1652d7f.bc5368",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "x": 570,
        "y": 60,
        "wires": []
    },
    {
        "id": "470568ab.3b7f",
        "type": "udp out",
        "z": "d1652d7f.bc5368",
        "name": "",
        "addr": "",
        "iface": "",
        "port": "",
        "ipv": "udp4",
        "outport": "",
        "base64": false,
        "multicast": "false",
        "x": 830,
        "y": 120,
        "wires": []
    },
    {
        "id": "71ffc66b.4963e",
        "type": "function",
        "z": "d1652d7f.bc5368",
        "name": "",
        "func": "\nif(msg.payload && typeof msg.payload == \"string\") {\n    msg.payload = JSON.parse(msg.payload);\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 370,
        "y": 60,
        "wires": [
            [
                "70389f48.06d2e8",
                "c46b033e.aa748"
            ]
        ]
    },
    {
        "id": "c46b033e.aa748",
        "type": "function",
        "z": "d1652d7f.bc5368",
        "name": "Form response packet",
        "func": "var ip = flow.get(\"host-ip\");\n\nmsg.payload.mqtt = {\n    server : ip,\n    port : \"1883\",\n    username : \"\",\n    password : \"\",\n    sensor : \"iot/raw/sensors/\" + msg.payload.deviceid,\n    relay : \"iot/relays/\" + msg.payload.deviceid,\n    caps : \"iot/caps/\" + msg.payload.deviceid,\n    ping : \"iot/ping/\" + msg.payload.deviceid,\n    motion : \"iot/raw/motion/\" + msg.payload.deviceid\n}\nmsg.payload.wifi = {\n    \"ssid\" : \"IoT\",\n    \"password\" : \"XXXXXXX\"\n}\n\ndevices = flow.get(\"iot-devices\");\n\nif(devices && msg.payload.deviceid) {\n   for(var d in devices) {\n       var device = devices[d];\n       if(device.deviceid === msg.payload.deviceid) {\n            msg.payload.device = device;\n        }\n   }\n}\n\nmsg.port = 3001;\nmsg.payload = JSON.stringify(msg.payload);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 610,
        "y": 120,
        "wires": [
            [
                "470568ab.3b7f",
                "872b85d2.49a93"
            ]
        ]
    },
    {
        "id": "872b85d2.49a93",
        "type": "debug",
        "z": "d1652d7f.bc5368",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "x": 830,
        "y": 180,
        "wires": []
    },
    {
        "id": "214c8430.6b44dc",
        "type": "inject",
        "z": "d1652d7f.bc5368",
        "name": "Reset all devices",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "x": 150,
        "y": 200,
        "wires": [
            [
                "727b9c27.30c80c"
            ]
        ]
    },
    {
        "id": "727b9c27.30c80c",
        "type": "function",
        "z": "d1652d7f.bc5368",
        "name": "",
        "func": "\nvar devices = [\n        {\n            deviceid : \"B1C69A\", \n            name : \"SunRoom\",\n            capabilities : []\n        },\n        {\n            deviceid : \"B1C535\", \n            name : \"Deck\",\n            capabilities : []\n        },\n         {\n            deviceid : \"D65D09\", \n            name : \"LivingRoom\",\n            capabilities : []\n        },\n         {\n            deviceid : \"3B1650\", \n            name : \"ServerCabinet\",\n            capabilities : []\n        },\n         {\n            deviceid : \"828732\", \n            name : \"Lab\",\n            capabilities : []\n        },\n         {\n            deviceid : \"34AD0C\", \n            name : \"Truck\",\n            capabilities : []\n        },\n         {\n            deviceid : \"82855C\", \n            name : \"Dev\",\n            capabilities : []\n        },\n         {\n            deviceid : \"35CC58\", \n            name : \"MasterBedroom\",\n            capabilities : []\n        }\n        \n    ];\n    \n\nflow.set(\"iot-devices\", devices);\n\nmsg.payload = devices;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 330,
        "y": 200,
        "wires": [
            [
                "5928b49a.b3afa4"
            ]
        ]
    },
    {
        "id": "5928b49a.b3afa4",
        "type": "debug",
        "z": "d1652d7f.bc5368",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "x": 490,
        "y": 200,
        "wires": []
    },
    {
        "id": "e08e5580.998438",
        "type": "mqtt out",
        "z": "d1652d7f.bc5368",
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "broker": "dd34f558.67dd78",
        "x": 490,
        "y": 320,
        "wires": []
    },
    {
        "id": "3b1358c2.c271e8",
        "type": "debug",
        "z": "d1652d7f.bc5368",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "x": 490,
        "y": 400,
        "wires": []
    },
    {
        "id": "1cab05f1.551c92",
        "type": "function",
        "z": "d1652d7f.bc5368",
        "name": "",
        "func": "var deviceid = msg.topic.split(\"/\")[3];\n\nmsg.topic = \"iot/sensors/\" + deviceid;\n\ndevices = flow.get(\"iot-devices\");\n\nif(devices && msg.payload.deviceid) {\n   for(var d in devices) {\n       var device = devices[d];\n       if(device.deviceid === msg.payload.deviceid) {\n           msg.payload.name = device.name;\n       }\n   }\n}\n\nif(msg && msg.payload) {\n    if(msg.payload.temp) {\n        msg.payload.humidity = msg.payload.hum;\n        delete msg.payload.hum;\n        msg.payload.pressure = msg.payload.press;\n        delete msg.payload.press;\n        msg.payload.altitude = msg.payload.alt;\n        delete msg.payload.alt;\n    }\n}\n\nif(msg.payload.ts) {\n    msg.payload.timeStamp = new Date(0);\n    msg.payload.timeStamp.setUTCSeconds(msg.payload.ts);\n}\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 330,
        "y": 320,
        "wires": [
            [
                "3b1358c2.c271e8",
                "e08e5580.998438"
            ]
        ]
    },
    {
        "id": "411fcdde.11d184",
        "type": "mqtt in",
        "z": "d1652d7f.bc5368",
        "name": "",
        "topic": "iot/caps/+",
        "qos": "2",
        "datatype": "json",
        "broker": "1fd1dcb7.25cbf3",
        "x": 680,
        "y": 320,
        "wires": [
            [
                "dbd0cb5e.db341"
            ]
        ]
    },
    {
        "id": "2c0b540a.7e1c24",
        "type": "debug",
        "z": "d1652d7f.bc5368",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "x": 950,
        "y": 320,
        "wires": []
    },
    {
        "id": "dbd0cb5e.db341",
        "type": "function",
        "z": "d1652d7f.bc5368",
        "name": "",
        "func": "\nif(msg.payload && msg.payload.caps && typeof msg.payload.caps == \"string\"){\n    msg.payload.caps = JSON.parse(msg.payload.caps);\n}\n\nif(msg.payload.deviceid) {\n    var devices = flow.get(\"iot-devices\");\n    if(devices) {\n        for(var d in devices){\n            var device = devices[d];\n            if(device.deviceid===msg.payload.deviceid) {\n                var found = false;\n                for(var c in device.capabilities) {\n                    var cap = device.capabilities[c];\n                    if(cap.cap === msg.payload.caps.cap) {\n                        found = true;\n                        break;\n                    }\n                }\n                if(!found) device.capabilities.push(msg.payload.caps);\n            }\n        }\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 810,
        "y": 320,
        "wires": [
            [
                "2c0b540a.7e1c24",
                "a99d9ef3.a6c4b"
            ]
        ]
    },
    {
        "id": "a5ec1617.463a78",
        "type": "function",
        "z": "d1652d7f.bc5368",
        "name": "",
        "func": "msg.payload = flow.get(\"iot-devices\");\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 330,
        "y": 240,
        "wires": [
            [
                "7833e01d.14ba88"
            ]
        ]
    },
    {
        "id": "3b40738d.a1bfb4",
        "type": "inject",
        "z": "d1652d7f.bc5368",
        "name": "List all devices",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 140,
        "y": 240,
        "wires": [
            [
                "a5ec1617.463a78"
            ]
        ]
    },
    {
        "id": "7833e01d.14ba88",
        "type": "debug",
        "z": "d1652d7f.bc5368",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "x": 490,
        "y": 240,
        "wires": []
    },
    {
        "id": "7c2b536f.bdedd4",
        "type": "mqtt in",
        "z": "d1652d7f.bc5368",
        "name": "",
        "topic": "iot/raw/sensors/+",
        "qos": "2",
        "datatype": "json",
        "broker": "1fd1dcb7.25cbf3",
        "x": 140,
        "y": 320,
        "wires": [
            [
                "1cab05f1.551c92"
            ]
        ]
    },
    {
        "id": "1f4197f.8e709e8",
        "type": "catch",
        "z": "d1652d7f.bc5368",
        "name": "",
        "scope": null,
        "uncaught": false,
        "x": 740,
        "y": 460,
        "wires": [
            [
                "ca3b8b83.bf431"
            ]
        ]
    },
    {
        "id": "ca3b8b83.bf431",
        "type": "debug",
        "z": "d1652d7f.bc5368",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "x": 910,
        "y": 460,
        "wires": []
    },
    {
        "id": "8964f370.108088",
        "type": "mqtt out",
        "z": "d86e1a52.17604",
        "name": "",
        "topic": "iot/relay/34AD0C",
        "qos": "2",
        "retain": "false",
        "broker": "1fd1dcb7.25cbf3",
        "x": 510,
        "y": 360,
        "wires": []
    },
    {
        "id": "b65843.3e1be7c",
        "type": "inject",
        "z": "d86e1a52.17604",
        "name": "0 - On",
        "topic": "",
        "payload": "{\"command\":\"on\",\"pin\":0}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 90,
        "y": 60,
        "wires": [
            [
                "8964f370.108088"
            ]
        ]
    },
    {
        "id": "bbe9bb27.37cda",
        "type": "inject",
        "z": "d86e1a52.17604",
        "name": "0 - Off",
        "topic": "",
        "payload": "{\"command\":\"off\",\"pin\":0}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 90,
        "y": 100,
        "wires": [
            [
                "8964f370.108088"
            ]
        ]
    },
    {
        "id": "1f29e75b.cadb89",
        "type": "inject",
        "z": "d86e1a52.17604",
        "name": "1 - On",
        "topic": "",
        "payload": "{\"command\":\"on\",\"pin\":1}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 90,
        "y": 160,
        "wires": [
            [
                "8964f370.108088"
            ]
        ]
    },
    {
        "id": "90fe36b6.768d98",
        "type": "inject",
        "z": "d86e1a52.17604",
        "name": "1 - Off",
        "topic": "",
        "payload": "{\"command\":\"off\",\"pin\":1}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 90,
        "y": 200,
        "wires": [
            [
                "8964f370.108088"
            ]
        ]
    },
    {
        "id": "c2c2c60a.855d1",
        "type": "inject",
        "z": "d86e1a52.17604",
        "name": "2 - On",
        "topic": "",
        "payload": "{\"command\":\"on\",\"pin\":2}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 90,
        "y": 260,
        "wires": [
            [
                "8964f370.108088"
            ]
        ]
    },
    {
        "id": "8eced9e2.c9c54",
        "type": "inject",
        "z": "d86e1a52.17604",
        "name": "2 - Off",
        "topic": "",
        "payload": "{\"command\":\"off\",\"pin\":2}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 90,
        "y": 300,
        "wires": [
            [
                "8964f370.108088"
            ]
        ]
    },
    {
        "id": "c5af6e44.39ff9",
        "type": "inject",
        "z": "d86e1a52.17604",
        "name": "3 - On",
        "topic": "",
        "payload": "{\"command\":\"on\",\"pin\":3}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 90,
        "y": 360,
        "wires": [
            [
                "8964f370.108088"
            ]
        ]
    },
    {
        "id": "3a26e026.311248",
        "type": "inject",
        "z": "d86e1a52.17604",
        "name": "3 - Off",
        "topic": "",
        "payload": "{\"command\":\"off\",\"pin\":3}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 90,
        "y": 400,
        "wires": [
            [
                "8964f370.108088"
            ]
        ]
    },
    {
        "id": "5fafa581.56b00c",
        "type": "inject",
        "z": "d86e1a52.17604",
        "name": "4 - On",
        "topic": "",
        "payload": "{\"command\":\"on\",\"pin\":4}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 90,
        "y": 460,
        "wires": [
            [
                "8964f370.108088"
            ]
        ]
    },
    {
        "id": "12c82080.5629f",
        "type": "inject",
        "z": "d86e1a52.17604",
        "name": "4 - Off",
        "topic": "",
        "payload": "{\"command\":\"off\",\"pin\":4}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 90,
        "y": 500,
        "wires": [
            [
                "8964f370.108088"
            ]
        ]
    },
    {
        "id": "73ea0912.bd0fb8",
        "type": "inject",
        "z": "d86e1a52.17604",
        "name": "5 - On",
        "topic": "",
        "payload": "{\"command\":\"on\",\"pin\":5}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 90,
        "y": 560,
        "wires": [
            [
                "8964f370.108088"
            ]
        ]
    },
    {
        "id": "1f65cc41.725b74",
        "type": "inject",
        "z": "d86e1a52.17604",
        "name": "5 - Off",
        "topic": "",
        "payload": "{\"command\":\"off\",\"pin\":5}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 90,
        "y": 600,
        "wires": [
            [
                "8964f370.108088"
            ]
        ]
    },
    {
        "id": "1dbfa8d6.607a5f",
        "type": "inject",
        "z": "d86e1a52.17604",
        "name": "All On",
        "topic": "",
        "payload": "{\"command\":\"allon\"}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 470,
        "y": 200,
        "wires": [
            [
                "8964f370.108088"
            ]
        ]
    },
    {
        "id": "1d9b6f68.792611",
        "type": "inject",
        "z": "d86e1a52.17604",
        "name": "All Off",
        "topic": "",
        "payload": "{\"command\":\"alloff\"}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 470,
        "y": 240,
        "wires": [
            [
                "8964f370.108088"
            ]
        ]
    },
    {
        "id": "d66f280f.a549e8",
        "type": "inject",
        "z": "d86e1a52.17604",
        "name": "Fun",
        "topic": "",
        "payload": "{\"command\":\"fun\"}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 470,
        "y": 140,
        "wires": [
            [
                "8964f370.108088"
            ]
        ]
    },
    {
        "id": "535f3b63.6c468c",
        "type": "inject",
        "z": "c5efaa53.c108",
        "name": "",
        "topic": "",
        "payload": "{\"command\" : \"reset\"}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 180,
        "y": 160,
        "wires": [
            [
                "87da812f.b0db48",
                "9465cea.91fef3",
                "8753740e.4bf5",
                "5c5edb4a.cb3054",
                "15412de8.76267a",
                "8a087c33.7a7fe"
            ]
        ]
    },
    {
        "id": "760d7303.955cb4",
        "type": "inject",
        "z": "c5efaa53.c108",
        "name": "",
        "topic": "",
        "payload": "{\"command\" : \"restart\"}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 180,
        "y": 200,
        "wires": [
            [
                "5c5edb4a.cb3054",
                "9465cea.91fef3",
                "8753740e.4bf5",
                "87da812f.b0db48",
                "15412de8.76267a",
                "8a087c33.7a7fe"
            ]
        ]
    },
    {
        "id": "507765c1.ac54ac",
        "type": "inject",
        "z": "c5efaa53.c108",
        "name": "",
        "topic": "",
        "payload": "{\"command\" : \"wipe\"}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 180,
        "y": 240,
        "wires": [
            [
                "8753740e.4bf5",
                "9465cea.91fef3",
                "5c5edb4a.cb3054",
                "87da812f.b0db48",
                "15412de8.76267a",
                "8a087c33.7a7fe"
            ]
        ]
    },
    {
        "id": "5b319451.0ce16c",
        "type": "inject",
        "z": "c5efaa53.c108",
        "name": "Update Wifi Config",
        "topic": "",
        "payload": "{\"command\" : \"reconfigure\", \"wifi\" : {\"ssid\" : \"IoT\", \"password\" : \"XXXXXXXX\"}}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 170,
        "y": 280,
        "wires": [
            [
                "9465cea.91fef3",
                "8753740e.4bf5",
                "5c5edb4a.cb3054",
                "87da812f.b0db48",
                "15412de8.76267a",
                "8a087c33.7a7fe"
            ]
        ]
    },
    {
        "id": "edb5211d.391a38",
        "type": "inject",
        "z": "c5efaa53.c108",
        "name": "",
        "topic": "",
        "payload": "{\"command\" : \"ping\"}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 170,
        "y": 520,
        "wires": [
            [
                "93094647.ab1ba8"
            ]
        ]
    },
    {
        "id": "497593d5.3705a4",
        "type": "mqtt in",
        "z": "c5efaa53.c108",
        "name": "Ping response",
        "topic": "iot/ping/82855C",
        "qos": "2",
        "datatype": "json",
        "broker": "1fd1dcb7.25cbf3",
        "x": 150,
        "y": 560,
        "wires": [
            [
                "a7eaa02c.7e64b8"
            ]
        ]
    },
    {
        "id": "c186321b.393e4",
        "type": "debug",
        "z": "c5efaa53.c108",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "x": 490,
        "y": 560,
        "wires": []
    },
    {
        "id": "93094647.ab1ba8",
        "type": "function",
        "z": "c5efaa53.c108",
        "name": "",
        "func": "\nmsg.payload.ts =  ((new Date()).getTime() / 1000) + \"\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 390,
        "y": 500,
        "wires": [
            [
                "a6e8ba16.382eb",
                "9465cea.91fef3",
                "8753740e.4bf5",
                "5c5edb4a.cb3054",
                "87da812f.b0db48",
                "15412de8.76267a",
                "8a087c33.7a7fe"
            ]
        ]
    },
    {
        "id": "a6e8ba16.382eb",
        "type": "debug",
        "z": "c5efaa53.c108",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "x": 610,
        "y": 520,
        "wires": []
    },
    {
        "id": "a7eaa02c.7e64b8",
        "type": "function",
        "z": "c5efaa53.c108",
        "name": "",
        "func": "\nif(msg.payload.senderTS === 0) return;\n\nmsg.payload.pongTS =  (new Date().getTime()) / 1000;\nmsg.payload.pongDiff = msg.payload.pongTS - msg.payload.ts;\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 330,
        "y": 560,
        "wires": [
            [
                "c186321b.393e4"
            ]
        ]
    },
    {
        "id": "15412de8.76267a",
        "type": "mqtt out",
        "z": "c5efaa53.c108",
        "name": "Living Room",
        "topic": "iot/relays/D65D09",
        "qos": "2",
        "retain": "false",
        "broker": "1fd1dcb7.25cbf3",
        "x": 690,
        "y": 80,
        "wires": []
    },
    {
        "id": "87da812f.b0db48",
        "type": "mqtt out",
        "z": "c5efaa53.c108",
        "name": "Lab",
        "topic": "iot/relays/828732",
        "qos": "2",
        "retain": "false",
        "broker": "1fd1dcb7.25cbf3",
        "x": 670,
        "y": 140,
        "wires": []
    },
    {
        "id": "5c5edb4a.cb3054",
        "type": "mqtt out",
        "z": "c5efaa53.c108",
        "name": "Sun Room",
        "topic": "iot/relays/B1C69A",
        "qos": "2",
        "retain": "false",
        "broker": "1fd1dcb7.25cbf3",
        "x": 690,
        "y": 200,
        "wires": []
    },
    {
        "id": "8753740e.4bf5",
        "type": "mqtt out",
        "z": "c5efaa53.c108",
        "name": "Deck",
        "topic": "iot/relays/B1C535",
        "qos": "2",
        "retain": "false",
        "broker": "1fd1dcb7.25cbf3",
        "x": 670,
        "y": 260,
        "wires": []
    },
    {
        "id": "8a087c33.7a7fe",
        "type": "mqtt out",
        "z": "c5efaa53.c108",
        "name": "Dev Device (82855C)",
        "topic": "iot/relays/82855C",
        "qos": "2",
        "retain": "false",
        "broker": "1fd1dcb7.25cbf3",
        "x": 720,
        "y": 380,
        "wires": []
    },
    {
        "id": "9465cea.91fef3",
        "type": "mqtt out",
        "z": "c5efaa53.c108",
        "name": "Server Cabinet",
        "topic": "iot/relays/3B1650",
        "qos": "2",
        "retain": "false",
        "broker": "1fd1dcb7.25cbf3",
        "x": 700,
        "y": 320,
        "wires": []
    },
    {
        "id": "779740ce.c0a",
        "type": "inject",
        "z": "c5efaa53.c108",
        "name": "OTA Update RELAY Build",
        "topic": "",
        "payload": "{\"command\":\"upgrade\",\"host\":\"10.0.0.4\",\"port\":8888,\"path\":\"/AthosIoT/RELAY_firmware.bin\"}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 190,
        "y": 320,
        "wires": [
            [
                "9465cea.91fef3",
                "8753740e.4bf5",
                "5c5edb4a.cb3054",
                "87da812f.b0db48",
                "15412de8.76267a",
                "8a087c33.7a7fe"
            ]
        ]
    },
    {
        "id": "d9e6f5ad.27131",
        "type": "inject",
        "z": "c5efaa53.c108",
        "name": "OTA Update BMP Build",
        "topic": "",
        "payload": "{\"command\":\"upgrade\",\"host\":\"10.0.0.4\",\"port\":8888,\"path\":\"/AthosIoT/BMP280_firmware.bin\"}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 180,
        "y": 360,
        "wires": [
            [
                "9465cea.91fef3",
                "8753740e.4bf5",
                "5c5edb4a.cb3054",
                "87da812f.b0db48",
                "15412de8.76267a",
                "8a087c33.7a7fe"
            ]
        ]
    },
    {
        "id": "fa5e4f69.37d048",
        "type": "inject",
        "z": "c5efaa53.c108",
        "name": "",
        "topic": "",
        "payload": "{\"command\" : \"reset\"}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 180,
        "y": 660,
        "wires": [
            [
                "8b6a3aea.54f478"
            ]
        ]
    },
    {
        "id": "4859f06c.46528",
        "type": "inject",
        "z": "c5efaa53.c108",
        "name": "",
        "topic": "",
        "payload": "{\"command\" : \"restart\"}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 180,
        "y": 700,
        "wires": [
            [
                "8b6a3aea.54f478"
            ]
        ]
    },
    {
        "id": "4e587a0.e4aa088",
        "type": "inject",
        "z": "c5efaa53.c108",
        "name": "",
        "topic": "",
        "payload": "{\"command\" : \"wipe\"}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 180,
        "y": 740,
        "wires": [
            [
                "8b6a3aea.54f478"
            ]
        ]
    },
    {
        "id": "847372a6.5b2c7",
        "type": "inject",
        "z": "c5efaa53.c108",
        "name": "Update Wifi Config",
        "topic": "",
        "payload": "{\"command\" : \"reconfigure\", \"wifi\" : {\"ssid\" : \"IoT\", \"password\" : \"XXXXXXXX\"}}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 170,
        "y": 780,
        "wires": [
            [
                "8b6a3aea.54f478"
            ]
        ]
    },
    {
        "id": "afe33075.19c558",
        "type": "inject",
        "z": "c5efaa53.c108",
        "name": "OTA Update RELAY Build",
        "topic": "",
        "payload": "{\"command\":\"upgrade\",\"host\":\"10.0.0.4\",\"port\":8888,\"path\":\"/AthosIoT/RELAY_firmware.bin\"}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 190,
        "y": 820,
        "wires": [
            [
                "8b6a3aea.54f478"
            ]
        ]
    },
    {
        "id": "78aeb252.136324",
        "type": "inject",
        "z": "c5efaa53.c108",
        "name": "OTA Update BMP Build",
        "topic": "",
        "payload": "{\"command\":\"upgrade\",\"host\":\"10.0.0.4\",\"port\":8888,\"path\":\"/AthosIoT/BMP280_firmware.bin\"}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 180,
        "y": 860,
        "wires": [
            [
                "8b6a3aea.54f478"
            ]
        ]
    },
    {
        "id": "8b6a3aea.54f478",
        "type": "mqtt out",
        "z": "c5efaa53.c108",
        "name": "Living Room",
        "topic": "iot/relays/D65D09",
        "qos": "2",
        "retain": "false",
        "broker": "1fd1dcb7.25cbf3",
        "x": 490,
        "y": 740,
        "wires": []
    },
    {
        "id": "bcd6a394.e1b668",
        "type": "inject",
        "z": "c5efaa53.c108",
        "name": "",
        "topic": "",
        "payload": "{\"command\" : \"reset\"}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 720,
        "y": 640,
        "wires": [
            [
                "b3920b33.861058"
            ]
        ]
    },
    {
        "id": "c6e013f5.37e678",
        "type": "inject",
        "z": "c5efaa53.c108",
        "name": "",
        "topic": "",
        "payload": "{\"command\" : \"restart\"}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 720,
        "y": 680,
        "wires": [
            [
                "b3920b33.861058"
            ]
        ]
    },
    {
        "id": "c66f5b41.7d4f1",
        "type": "inject",
        "z": "c5efaa53.c108",
        "name": "",
        "topic": "",
        "payload": "{\"command\" : \"wipe\"}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 720,
        "y": 720,
        "wires": [
            [
                "b3920b33.861058"
            ]
        ]
    },
    {
        "id": "8cf32478.0bd398",
        "type": "inject",
        "z": "c5efaa53.c108",
        "name": "Update Wifi Config",
        "topic": "",
        "payload": "{\"command\" : \"reconfigure\", \"wifi\" : {\"ssid\" : \"IoT\", \"password\" : \"XXXXXXXX\"}}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 710,
        "y": 760,
        "wires": [
            [
                "b3920b33.861058"
            ]
        ]
    },
    {
        "id": "68e7a504.f43794",
        "type": "inject",
        "z": "c5efaa53.c108",
        "name": "OTA Update RELAY Build",
        "topic": "",
        "payload": "{\"command\":\"upgrade\",\"host\":\"10.0.0.4\",\"port\":8888,\"path\":\"/AthosIoT/RELAY_firmware.bin\"}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 730,
        "y": 800,
        "wires": [
            [
                "b3920b33.861058"
            ]
        ]
    },
    {
        "id": "a0c2bff7.559578",
        "type": "inject",
        "z": "c5efaa53.c108",
        "name": "OTA Update BMP Build",
        "topic": "",
        "payload": "{\"command\":\"upgrade\",\"host\":\"10.0.0.4\",\"port\":8888,\"path\":\"/AthosIoT/BMP280_firmware.bin\"}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 720,
        "y": 840,
        "wires": [
            [
                "b3920b33.861058"
            ]
        ]
    },
    {
        "id": "b3920b33.861058",
        "type": "mqtt out",
        "z": "c5efaa53.c108",
        "name": "Lab",
        "topic": "iot/relays/828732",
        "qos": "2",
        "retain": "false",
        "broker": "1fd1dcb7.25cbf3",
        "x": 1030,
        "y": 720,
        "wires": []
    },
    {
        "id": "116aeb8e.504c44",
        "type": "inject",
        "z": "c5efaa53.c108",
        "name": "",
        "topic": "",
        "payload": "{\"command\" : \"reset\"}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 180,
        "y": 940,
        "wires": [
            [
                "96cf2d85.6f7b48"
            ]
        ]
    },
    {
        "id": "c4cc62ff.7cbf48",
        "type": "inject",
        "z": "c5efaa53.c108",
        "name": "",
        "topic": "",
        "payload": "{\"command\" : \"restart\"}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 180,
        "y": 980,
        "wires": [
            [
                "96cf2d85.6f7b48"
            ]
        ]
    },
    {
        "id": "79116bc2.8b7394",
        "type": "inject",
        "z": "c5efaa53.c108",
        "name": "",
        "topic": "",
        "payload": "{\"command\" : \"wipe\"}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 180,
        "y": 1020,
        "wires": [
            [
                "96cf2d85.6f7b48"
            ]
        ]
    },
    {
        "id": "6b5317cb.5140e",
        "type": "inject",
        "z": "c5efaa53.c108",
        "name": "Update Wifi Config",
        "topic": "",
        "payload": "{\"command\" : \"reconfigure\", \"wifi\" : {\"ssid\" : \"IoT\", \"password\" : \"XXXXXXXX\"}}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 170,
        "y": 1060,
        "wires": [
            [
                "96cf2d85.6f7b48"
            ]
        ]
    },
    {
        "id": "526835eb.a9fa6c",
        "type": "inject",
        "z": "c5efaa53.c108",
        "name": "OTA Update RELAY Build",
        "topic": "",
        "payload": "{\"command\":\"upgrade\",\"host\":\"10.0.0.4\",\"port\":8888,\"path\":\"/AthosIoT/RELAY_firmware.bin\"}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 190,
        "y": 1100,
        "wires": [
            [
                "96cf2d85.6f7b48"
            ]
        ]
    },
    {
        "id": "e0d8557f.97eed",
        "type": "inject",
        "z": "c5efaa53.c108",
        "name": "OTA Update BMP Build",
        "topic": "",
        "payload": "{\"command\":\"upgrade\",\"host\":\"10.0.0.4\",\"port\":8888,\"path\":\"/AthosIoT/BMP280_firmware.bin\"}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 180,
        "y": 1140,
        "wires": [
            [
                "96cf2d85.6f7b48"
            ]
        ]
    },
    {
        "id": "96cf2d85.6f7b48",
        "type": "mqtt out",
        "z": "c5efaa53.c108",
        "name": "Sun Room",
        "topic": "iot/relays/B1C69A",
        "qos": "2",
        "retain": "false",
        "broker": "1fd1dcb7.25cbf3",
        "x": 470,
        "y": 1000,
        "wires": []
    },
    {
        "id": "f8001289.c1239",
        "type": "inject",
        "z": "c5efaa53.c108",
        "name": "",
        "topic": "",
        "payload": "{\"command\" : \"reset\"}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 720,
        "y": 940,
        "wires": [
            [
                "22c3f95.5253f86"
            ]
        ]
    },
    {
        "id": "9e2f6cd8.d18a78",
        "type": "inject",
        "z": "c5efaa53.c108",
        "name": "",
        "topic": "",
        "payload": "{\"command\" : \"restart\"}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 720,
        "y": 980,
        "wires": [
            [
                "22c3f95.5253f86"
            ]
        ]
    },
    {
        "id": "dad2bfeb.a79e8",
        "type": "inject",
        "z": "c5efaa53.c108",
        "name": "",
        "topic": "",
        "payload": "{\"command\" : \"wipe\"}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 720,
        "y": 1020,
        "wires": [
            [
                "22c3f95.5253f86"
            ]
        ]
    },
    {
        "id": "8ad65153.b61aa8",
        "type": "inject",
        "z": "c5efaa53.c108",
        "name": "Update Wifi Config",
        "topic": "",
        "payload": "{\"command\" : \"reconfigure\", \"wifi\" : {\"ssid\" : \"IoT\", \"password\" : \"XXXXXXXX\"}}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 710,
        "y": 1060,
        "wires": [
            [
                "22c3f95.5253f86"
            ]
        ]
    },
    {
        "id": "95564ff7.56a698",
        "type": "inject",
        "z": "c5efaa53.c108",
        "name": "OTA Update RELAY Build",
        "topic": "",
        "payload": "{\"command\":\"upgrade\",\"host\":\"10.0.0.4\",\"port\":8888,\"path\":\"/AthosIoT/RELAY_firmware.bin\"}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 730,
        "y": 1100,
        "wires": [
            [
                "22c3f95.5253f86"
            ]
        ]
    },
    {
        "id": "b1f65179.ded8a8",
        "type": "inject",
        "z": "c5efaa53.c108",
        "name": "OTA Update BMP Build",
        "topic": "",
        "payload": "{\"command\":\"upgrade\",\"host\":\"10.0.0.4\",\"port\":8888,\"path\":\"/AthosIoT/BMP280_firmware.bin\"}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 720,
        "y": 1140,
        "wires": [
            [
                "22c3f95.5253f86"
            ]
        ]
    },
    {
        "id": "22c3f95.5253f86",
        "type": "mqtt out",
        "z": "c5efaa53.c108",
        "name": "Deck",
        "topic": "iot/relays/B1C535",
        "qos": "2",
        "retain": "false",
        "broker": "1fd1dcb7.25cbf3",
        "x": 1030,
        "y": 1040,
        "wires": []
    },
    {
        "id": "9215f8ee.9928b8",
        "type": "inject",
        "z": "c5efaa53.c108",
        "name": "",
        "topic": "",
        "payload": "{\"command\" : \"reset\"}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 180,
        "y": 1240,
        "wires": [
            [
                "8758bc69.0e67f"
            ]
        ]
    },
    {
        "id": "e4e65780.b4fd9",
        "type": "inject",
        "z": "c5efaa53.c108",
        "name": "",
        "topic": "",
        "payload": "{\"command\" : \"restart\"}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 180,
        "y": 1280,
        "wires": [
            [
                "8758bc69.0e67f"
            ]
        ]
    },
    {
        "id": "9c52cc16.3e543",
        "type": "inject",
        "z": "c5efaa53.c108",
        "name": "",
        "topic": "",
        "payload": "{\"command\" : \"wipe\"}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 180,
        "y": 1320,
        "wires": [
            [
                "8758bc69.0e67f"
            ]
        ]
    },
    {
        "id": "fa7fe7f2.56c958",
        "type": "inject",
        "z": "c5efaa53.c108",
        "name": "Update Wifi Config",
        "topic": "",
        "payload": "{\"command\" : \"reconfigure\", \"wifi\" : {\"ssid\" : \"IoT\", \"password\" : \"XXXXXXXX\"}}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 170,
        "y": 1360,
        "wires": [
            [
                "8758bc69.0e67f"
            ]
        ]
    },
    {
        "id": "519118f4.f9e988",
        "type": "inject",
        "z": "c5efaa53.c108",
        "name": "OTA Update RELAY Build",
        "topic": "",
        "payload": "{\"command\":\"upgrade\",\"host\":\"10.0.0.4\",\"port\":8888,\"path\":\"/AthosIoT/RELAY_firmware.bin\"}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 190,
        "y": 1400,
        "wires": [
            [
                "8758bc69.0e67f"
            ]
        ]
    },
    {
        "id": "5c11d621.329b2",
        "type": "inject",
        "z": "c5efaa53.c108",
        "name": "OTA Update BMP Build",
        "topic": "",
        "payload": "{\"command\":\"upgrade\",\"host\":\"10.0.0.4\",\"port\":8888,\"path\":\"/AthosIoT/BMP280_firmware.bin\"}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 180,
        "y": 1440,
        "wires": [
            [
                "8758bc69.0e67f"
            ]
        ]
    },
    {
        "id": "8758bc69.0e67f",
        "type": "mqtt out",
        "z": "c5efaa53.c108",
        "name": "Server Cabinet",
        "topic": "iot/relays/3B1650",
        "qos": "2",
        "retain": "false",
        "broker": "1fd1dcb7.25cbf3",
        "x": 480,
        "y": 1320,
        "wires": []
    },
    {
        "id": "1a0cad38.2b403b",
        "type": "inject",
        "z": "c5efaa53.c108",
        "name": "",
        "topic": "",
        "payload": "{\"command\" : \"reset\"}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 720,
        "y": 1240,
        "wires": [
            [
                "75eb69e8.c9e818"
            ]
        ]
    },
    {
        "id": "67448214.0d827c",
        "type": "inject",
        "z": "c5efaa53.c108",
        "name": "",
        "topic": "",
        "payload": "{\"command\" : \"restart\"}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 720,
        "y": 1280,
        "wires": [
            [
                "75eb69e8.c9e818"
            ]
        ]
    },
    {
        "id": "de8f3bca.e4f18",
        "type": "inject",
        "z": "c5efaa53.c108",
        "name": "",
        "topic": "",
        "payload": "{\"command\" : \"wipe\"}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 720,
        "y": 1320,
        "wires": [
            [
                "75eb69e8.c9e818"
            ]
        ]
    },
    {
        "id": "6fec24a5.76453c",
        "type": "inject",
        "z": "c5efaa53.c108",
        "name": "Update Wifi Config",
        "topic": "",
        "payload": "{\"command\" : \"reconfigure\", \"wifi\" : {\"ssid\" : \"IoT\", \"password\" : \"XXXXXXXX\"}}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 710,
        "y": 1360,
        "wires": [
            [
                "75eb69e8.c9e818"
            ]
        ]
    },
    {
        "id": "ac111499.808248",
        "type": "inject",
        "z": "c5efaa53.c108",
        "name": "OTA Update RELAY Build",
        "topic": "",
        "payload": "{\"command\":\"upgrade\",\"host\":\"10.0.0.4\",\"port\":8888,\"path\":\"/AthosIoT/RELAY_firmware.bin\"}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 730,
        "y": 1400,
        "wires": [
            [
                "75eb69e8.c9e818"
            ]
        ]
    },
    {
        "id": "d0121685.88eb3",
        "type": "inject",
        "z": "c5efaa53.c108",
        "name": "OTA Update PIR Build",
        "topic": "",
        "payload": "{\"command\":\"upgrade\",\"host\":\"10.0.0.4\",\"port\":8888,\"path\":\"/AthosIoT/PIR_firmware.bin\"}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 720,
        "y": 1440,
        "wires": [
            [
                "75eb69e8.c9e818"
            ]
        ]
    },
    {
        "id": "75eb69e8.c9e818",
        "type": "mqtt out",
        "z": "c5efaa53.c108",
        "name": "Dev Device (82855C)",
        "topic": "iot/relays/82855C",
        "qos": "2",
        "retain": "false",
        "broker": "1fd1dcb7.25cbf3",
        "x": 1060,
        "y": 1340,
        "wires": []
    },
    {
        "id": "689b18b5.5d7948",
        "type": "mqtt in",
        "z": "15023940.e18267",
        "name": "",
        "topic": "iot/motion/+",
        "qos": "2",
        "datatype": "json",
        "broker": "1fd1dcb7.25cbf3",
        "x": 170,
        "y": 80,
        "wires": [
            [
                "fb28a3c7.aa0dc"
            ]
        ]
    },
    {
        "id": "41793944.8737c8",
        "type": "debug",
        "z": "15023940.e18267",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "x": 510,
        "y": 80,
        "wires": []
    },
    {
        "id": "fb28a3c7.aa0dc",
        "type": "function",
        "z": "15023940.e18267",
        "name": "",
        "func": "\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 350,
        "y": 80,
        "wires": [
            [
                "41793944.8737c8",
                "e5a35238.03cdb8"
            ]
        ],
        "inputLabels": [
            "MQTT"
        ],
        "outputLabels": [
            "Dev",
            "Living Room"
        ]
    },
    {
        "id": "1f45e74c.cb4419",
        "type": "mqtt in",
        "z": "d1652d7f.bc5368",
        "name": "",
        "topic": "iot/raw/motion/+",
        "qos": "2",
        "datatype": "json",
        "broker": "1fd1dcb7.25cbf3",
        "x": 140,
        "y": 460,
        "wires": [
            [
                "2a419e7.51a5362"
            ]
        ]
    },
    {
        "id": "2a419e7.51a5362",
        "type": "function",
        "z": "d1652d7f.bc5368",
        "name": "",
        "func": "\nvar deviceid = msg.topic.split(\"/\")[3];\n\nmsg.topic = \"iot/motion/\" + deviceid;\n\ndevices = flow.get(\"iot-devices\");\n\nif(devices && msg.payload.deviceid) {\n   for(var d in devices) {\n       var device = devices[d];\n       if(device.deviceid === msg.payload.deviceid) {\n           msg.payload.name = device.name;\n       }\n   }\n}\n\nif(msg.payload.ts) {\n    msg.payload.timeStamp = new Date(0);\n    msg.payload.timeStamp.setUTCSeconds(msg.payload.ts);\n}\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 330,
        "y": 460,
        "wires": [
            [
                "3cf46c49.f4ed64",
                "cd43d63b.3bfc5"
            ]
        ]
    },
    {
        "id": "3cf46c49.f4ed64",
        "type": "debug",
        "z": "d1652d7f.bc5368",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "x": 490,
        "y": 540,
        "wires": []
    },
    {
        "id": "cd43d63b.3bfc5",
        "type": "mqtt out",
        "z": "d1652d7f.bc5368",
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "broker": "dd34f558.67dd78",
        "x": 490,
        "y": 460,
        "wires": []
    },
    {
        "id": "40aa1297.60f244",
        "type": "inject",
        "z": "d1652d7f.bc5368",
        "name": "Get machine ip address",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "x": 210,
        "y": 620,
        "wires": [
            [
                "cc4f8bb4.194f8"
            ]
        ]
    },
    {
        "id": "cc4f8bb4.194f8",
        "type": "exec",
        "z": "d1652d7f.bc5368",
        "command": "hostname -I ",
        "addpay": false,
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "oldrc": false,
        "name": "",
        "x": 450,
        "y": 620,
        "wires": [
            [
                "55fb340e.6a326c"
            ],
            [],
            []
        ]
    },
    {
        "id": "55fb340e.6a326c",
        "type": "function",
        "z": "d1652d7f.bc5368",
        "name": "",
        "func": "\nif(msg && msg.payload) {\n    msg.payload = msg.payload.trim();\n    var space = msg.payload.indexOf(\" \");\n    if(space > 0) {\n        var ips = msg.payload.split(\" \");\n        for(var i in ips) {\n            var ip = ips[i];\n            if(!ip.startsWith(\"10.3.\")) {\n                msg.payload = ip;\n            }\n        }\n    }\n}\n\n\n\nflow.set(\"host-ip\", msg.payload);\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 630,
        "y": 620,
        "wires": [
            [
                "6f528aee.9c2c9c"
            ]
        ]
    },
    {
        "id": "6f528aee.9c2c9c",
        "type": "debug",
        "z": "d1652d7f.bc5368",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "x": 790,
        "y": 620,
        "wires": []
    },
    {
        "id": "a99d9ef3.a6c4b",
        "type": "mqtt out",
        "z": "d1652d7f.bc5368",
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "broker": "dd34f558.67dd78",
        "x": 950,
        "y": 280,
        "wires": []
    },
    {
        "id": "e5a35238.03cdb8",
        "type": "mqtt out",
        "z": "15023940.e18267",
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "broker": "dd34f558.67dd78",
        "x": 510,
        "y": 140,
        "wires": []
    }
]